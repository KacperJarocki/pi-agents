# =========================
# IoT / LAB starter rules (Suricata 7 compatible)
# =========================

# 1) Ping w sieci (test czy IDS widzi ruch)
alert icmp any any -> $HOME_NET any (msg:"LOCAL ICMP ping to HOME_NET"; itype:8; sid:1000001; rev:1;)

# 2) Prosty portscan (SYN) – fajne do testów nmapem
alert tcp any any -> $HOME_NET any (msg:"LOCAL Possible TCP SYN scan (many ports)"; flags:S; threshold:type both, track by_src, count 20, seconds 10; sid:1000002; rev:1;)

# 3) Dużo prób TCP do wielu portów / szybkie łączenie (scan-ish)
# (lepsze niż stateless "connection rate", bo patrzymy na SYN do serwera)
alert tcp any any -> $HOME_NET any (msg:"LOCAL High TCP SYN rate to HOME_NET (scan/brute-ish)"; flags:S; flow:to_server; threshold:type both, track by_src, count 50, seconds 10; sid:1000003; rev:2;)

# 4) DNS - bardzo długie nazwy (tunneling-ish / dziwne IoT)
alert dns $HOME_NET any -> $EXTERNAL_NET any (msg:"LOCAL DNS suspiciously long query (possible tunneling)"; dns.query; content:"."; pcre:"/^[A-Za-z0-9\\-\\.]{60,}\\./"; sid:1000004; rev:2;)

# 5) DNS - dużo zapytań w krótkim czasie (chatty IoT)
alert dns $HOME_NET any -> $EXTERNAL_NET any (msg:"LOCAL High DNS query rate (chatty device)"; threshold:type both, track by_src, count 30, seconds 10; sid:1000005; rev:1;)

# 6) HTTP - podejrzany user-agent typowy dla skanerów/botów
alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"LOCAL Suspicious HTTP User-Agent (scanner/bot)"; http.user_agent; pcre:"/(curl|wget|python-requests|libwww-perl|Go-http-client|nikto|sqlmap)/i"; sid:1000006; rev:2;)

# 7) HTTP - requesty do /cgi-bin (IoT często ma web panele)
alert http $EXTERNAL_NET any -> $HOME_NET any (msg:"LOCAL Inbound HTTP access to /cgi-bin (IoT web admin probing)"; http.uri; content:"/cgi-bin"; nocase; sid:1000007; rev:1;)

# 8) TLS - SNI puste (czasem malware/niestandardowe klienty) – low noise, ale sygnał
alert tls $HOME_NET any -> $EXTERNAL_NET any (msg:"LOCAL TLS with empty/absent SNI (unusual)"; tls.sni; content:!"."; sid:1000008; rev:1;)

# 9) SMB/NetBIOS w sieci IoT (często niepotrzebne)
alert udp $HOME_NET any -> $HOME_NET 137 (msg:"LOCAL NetBIOS Name Service traffic (NBNS)"; sid:1000009; rev:1;)
alert tcp $HOME_NET any -> $HOME_NET 445 (msg:"LOCAL SMB traffic detected (review necessity in IoT)"; flow:to_server; sid:1000010; rev:2;)

# 10) Telnet w LAN (IoT malware lub stare urządzenia)
alert tcp $HOME_NET any -> $EXTERNAL_NET 23 (msg:"LOCAL Telnet outbound (possible risky IoT)"; sid:1000011; rev:1;)
alert tcp $EXTERNAL_NET any -> $HOME_NET 23 (msg:"LOCAL Telnet inbound attempt"; sid:1000012; rev:1;)
